// Sandbox Analysis - Safe malware testing environments

import React, { useState } from 'react';
import { motion } from 'framer-motion';
import { ShieldExclamationIcon, PlayIcon, CheckCircleIcon } from '@heroicons/react/24/outline';

const SandboxSection: React.FC = () => {
  const [sandboxRunning, setSandboxRunning] = useState(false);
  const [analysisSteps, setAnalysisSteps] = useState<string[]>([]);
  const [currentStep, setCurrentStep] = useState(0);
  const [reportGenerated, setReportGenerated] = useState(false);

  const runSandboxAnalysis = () => {
    setSandboxRunning(true);
    setAnalysisSteps([]);
    setCurrentStep(0);
    setReportGenerated(false);

    const steps = [
      'üîí Initializing isolated virtual machine...',
      'üì∏ Taking VM snapshot for restoration...',
      'üîå Disconnecting network (safe mode)...',
      'üìÇ Loading malware sample into sandbox...',
      '‚ñ∂Ô∏è Executing malicious file...',
      'üëÅÔ∏è Monitoring file system changes...',
      'üîë Tracking registry modifications...',
      '‚öôÔ∏è Recording process creation...',
      'üì° Capturing network attempts...',
      'üíæ Analyzing memory dumps...',
      'üìä Generating behavior report...',
      '‚úÖ Analysis complete - VM restored to clean state!'
    ];

    let index = 0;
    const interval = setInterval(() => {
      if (index < steps.length) {
        setAnalysisSteps(prev => [...prev, steps[index]]);
        setCurrentStep(index + 1);
        index++;
      } else {
        clearInterval(interval);
        setSandboxRunning(false);
        setTimeout(() => setReportGenerated(true), 500);
      }
    }, 700);
  };

  return (
    <div className="space-y-6">
      <div className="bg-atom-bg bg-opacity-50 rounded-lg p-6 border-l-4 border-atom-purple">
        <h3 className="text-2xl font-bold text-atom-purple mb-4 flex items-center">
          <ShieldExclamationIcon className="h-8 w-8 mr-3" />
          Sandbox Analysis Environments
        </h3>
        <p className="text-lg text-atom-fg-muted mb-4">
          A sandbox is an isolated, controlled environment where malware can be safely executed and 
          studied without risking real systems. Think of it as a "blast-proof testing chamber" for 
          dangerous code!
        </p>
      </div>

      <div className="grid md:grid-cols-2 gap-6">
        <div className="bg-blue-900 bg-opacity-20 rounded-lg p-6 border border-blue-500 border-opacity-30">
          <h4 className="text-blue-400 font-bold text-xl mb-3">üõ†Ô∏è Popular Sandboxes</h4>
          <ul className="space-y-2 text-blue-300 text-sm">
            <li className="p-2 bg-blue-900 bg-opacity-20 rounded">
              <strong>Any.run:</strong> Interactive online sandbox with real-time control
            </li>
            <li className="p-2 bg-blue-900 bg-opacity-20 rounded">
              <strong>Cuckoo:</strong> Open-source automated malware analysis
            </li>
            <li className="p-2 bg-blue-900 bg-opacity-20 rounded">
              <strong>Joe Sandbox:</strong> Professional deep malware inspection
            </li>
            <li className="p-2 bg-blue-900 bg-opacity-20 rounded">
              <strong>Hybrid Analysis:</strong> Free community-driven platform
            </li>
            <li className="p-2 bg-blue-900 bg-opacity-20 rounded">
              <strong>VirusTotal:</strong> Multi-engine scanning and analysis
            </li>
          </ul>
        </div>

        <div className="bg-orange-900 bg-opacity-20 rounded-lg p-6 border border-orange-500 border-opacity-30">
          <h4 className="text-orange-400 font-bold text-xl mb-3">‚ö° What Sandboxes Monitor</h4>
          <ul className="space-y-2 text-orange-300 text-sm">
            <li className="p-2 bg-orange-900 bg-opacity-20 rounded">
              <strong>üìÅ File System:</strong> Files created, modified, or deleted
            </li>
            <li className="p-2 bg-orange-900 bg-opacity-20 rounded">
              <strong>üîë Registry:</strong> Windows registry key changes
            </li>
            <li className="p-2 bg-orange-900 bg-opacity-20 rounded">
              <strong>üì° Network:</strong> DNS queries, connections, data transfer
            </li>
            <li className="p-2 bg-orange-900 bg-opacity-20 rounded">
              <strong>‚öôÔ∏è Processes:</strong> New processes, injections, threads
            </li>
            <li className="p-2 bg-orange-900 bg-opacity-20 rounded">
              <strong>üíæ Memory:</strong> Runtime behavior and hidden payloads
            </li>
          </ul>
        </div>
      </div>

      <div className="bg-yellow-900 bg-opacity-20 rounded-lg p-6 border border-yellow-500 border-opacity-30">
        <h4 className="text-yellow-400 font-bold text-xl mb-3">üîí Sandbox Safety Features</h4>
        <div className="grid md:grid-cols-2 gap-4 text-yellow-300 text-sm">
          <div>
            <p className="font-bold mb-2">Isolation Methods:</p>
            <ul className="space-y-1">
              <li>‚Ä¢ <strong>Virtual Machines:</strong> Complete OS isolation</li>
              <li>‚Ä¢ <strong>Containers:</strong> Lightweight process isolation</li>
              <li>‚Ä¢ <strong>Network Isolation:</strong> No internet access</li>
              <li>‚Ä¢ <strong>Snapshots:</strong> Instant restore to clean state</li>
            </ul>
          </div>
          <div>
            <p className="font-bold mb-2">Protection Layers:</p>
            <ul className="space-y-1">
              <li>‚Ä¢ No access to host system files</li>
              <li>‚Ä¢ Blocked outbound connections</li>
              <li>‚Ä¢ Monitored API calls</li>
              <li>‚Ä¢ Automatic cleanup after analysis</li>
            </ul>
          </div>
        </div>
      </div>

      <div className="bg-atom-bg bg-opacity-50 rounded-lg p-6 border border-atom-purple border-opacity-30">
        <h4 className="text-atom-purple font-bold text-xl mb-4">üéÆ Interactive: Automated Sandbox Analysis</h4>
        <p className="text-atom-fg-muted mb-4">
          Watch how an automated sandbox analyzes a malware sample step-by-step:
        </p>

        <button
          onClick={runSandboxAnalysis}
          disabled={sandboxRunning || analysisSteps.length > 0}
          className="px-6 py-3 bg-atom-purple text-white rounded-lg hover:bg-opacity-80 transition-colors font-bold disabled:opacity-50 flex items-center space-x-2"
        >
          <PlayIcon className="h-5 w-5" />
          <span>{analysisSteps.length > 0 ? 'Analysis Complete' : 'Start Sandbox Analysis'}</span>
        </button>

        {analysisSteps.length > 0 && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            className="mt-4"
          >
            <div className="bg-black bg-opacity-70 rounded-lg p-4 border-2 border-purple-500">
              <div className="flex items-center justify-between mb-3">
                <div className="text-purple-400 font-mono font-bold">
                  ‚ïê‚ïê‚ïê AUTOMATED SANDBOX ‚ïê‚ïê‚ïê
                </div>
                {sandboxRunning && (
                  <div className="flex items-center space-x-2">
                    <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span className="text-green-400 text-sm font-mono">ANALYZING</span>
                  </div>
                )}
              </div>
              
              {/* Progress Bar */}
              <div className="mb-3">
                <div className="flex justify-between text-xs text-purple-300 mb-1">
                  <span>Progress</span>
                  <span>{Math.round((currentStep / 12) * 100)}%</span>
                </div>
                <div className="w-full bg-atom-bg rounded-full h-2">
                  <motion.div
                    className="bg-purple-500 h-2 rounded-full"
                    initial={{ width: 0 }}
                    animate={{ width: `${(currentStep / 12) * 100}%` }}
                    transition={{ duration: 0.5 }}
                  />
                </div>
              </div>

              <div className="space-y-1 max-h-80 overflow-y-auto font-mono text-sm">
                {analysisSteps.map((step, index) => (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    className={`${
                      step.includes('‚úÖ') ? 'text-green-400 font-bold' :
                      step.includes('‚ö†Ô∏è') || step.includes('üö®') ? 'text-yellow-400' :
                      'text-cyan-400'
                    }`}
                  >
                    {step}
                  </motion.div>
                ))}
              </div>

              {!sandboxRunning && analysisSteps.length > 0 && (
                <button
                  onClick={() => {
                    setAnalysisSteps([]);
                    setCurrentStep(0);
                    setReportGenerated(false);
                  }}
                  className="mt-4 px-4 py-2 bg-atom-blue text-white rounded hover:bg-opacity-80 transition-colors text-sm"
                >
                  Run Another Analysis
                </button>
              )}
            </div>
          </motion.div>
        )}

        {reportGenerated && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="mt-4 bg-green-900 bg-opacity-20 rounded-lg p-6 border border-green-500"
          >
            <h5 className="text-green-400 font-bold text-lg mb-3 flex items-center">
              <CheckCircleIcon className="h-6 w-6 mr-2" />
              Comprehensive Analysis Report Generated
            </h5>
            
            <div className="grid md:grid-cols-2 gap-4 text-sm mb-4">
              <div className="bg-black bg-opacity-30 p-3 rounded">
                <p className="text-green-300 font-bold mb-2">Detected Behaviors:</p>
                <ul className="text-green-300 space-y-1 text-xs">
                  <li>‚úì Registry persistence mechanism</li>
                  <li>‚úì Network C2 communication</li>
                  <li>‚úì Process injection detected</li>
                  <li>‚úì File encryption activity</li>
                  <li>‚úì Anti-debugging techniques</li>
                </ul>
              </div>
              <div className="bg-black bg-opacity-30 p-3 rounded">
                <p className="text-blue-300 font-bold mb-2">Extracted IOCs:</p>
                <ul className="text-blue-300 space-y-1 text-xs font-mono">
                  <li>IP: 198.51.100.42</li>
                  <li>Domain: evil-c2.bad</li>
                  <li>Hash: 5d41402abc...</li>
                  <li>Mutex: Malware_X9</li>
                  <li>Path: C:\temp\mal.exe</li>
                </ul>
              </div>
            </div>

            <div className="bg-red-900 bg-opacity-20 p-4 rounded border border-red-500 border-opacity-30">
              <p className="text-red-300 font-bold mb-2">üö® Threat Assessment:</p>
              <p className="text-red-300 text-sm">
                <strong>Classification:</strong> Ransomware Trojan<br/>
                <strong>Severity:</strong> HIGH<br/>
                <strong>Risk:</strong> Data encryption, credential theft, lateral movement<br/>
                <strong>Recommendation:</strong> Block all IOCs immediately and scan network for infections
              </p>
            </div>
          </motion.div>
        )}
      </div>

      <div className="bg-atom-bg bg-opacity-50 rounded-lg p-6 border border-atom-blue border-opacity-30">
        <h4 className="text-atom-blue font-bold text-xl mb-4">üéØ Understanding Sandbox Limitations</h4>
        <p className="text-atom-fg-muted mb-3">
          While powerful, sandboxes have limitations that advanced malware exploits:
        </p>
        <div className="grid md:grid-cols-2 gap-4">
          <div className="bg-red-900 bg-opacity-20 p-4 rounded border border-red-500 border-opacity-30">
            <p className="text-red-400 font-bold mb-2">Evasion Techniques:</p>
            <ul className="text-red-300 space-y-1 text-sm">
              <li>‚Ä¢ <strong>VM Detection:</strong> Checks for virtualization</li>
              <li>‚Ä¢ <strong>Time Delays:</strong> Waits hours before activating</li>
              <li>‚Ä¢ <strong>User Interaction:</strong> Requires mouse clicks</li>
              <li>‚Ä¢ <strong>Sandbox Fingerprinting:</strong> Detects analysis tools</li>
            </ul>
          </div>
          <div className="bg-green-900 bg-opacity-20 p-4 rounded border border-green-500 border-opacity-30">
            <p className="text-green-400 font-bold mb-2">Analyst Countermeasures:</p>
            <ul className="text-green-300 space-y-1 text-sm">
              <li>‚Ä¢ <strong>Bare Metal Analysis:</strong> Use real hardware</li>
              <li>‚Ä¢ <strong>Extended Runtime:</strong> Run for hours/days</li>
              <li>‚Ä¢ <strong>Simulate Activity:</strong> Fake user interactions</li>
              <li>‚Ä¢ <strong>Hide Artifacts:</strong> Mask sandbox indicators</li>
            </ul>
          </div>
        </div>
      </div>

      <div className="bg-purple-900 bg-opacity-20 rounded-lg p-6 border border-purple-500 border-opacity-30">
        <h4 className="text-purple-400 font-bold text-xl mb-3">üéì Key Takeaways</h4>
        <ul className="space-y-2 text-purple-300">
          <li>‚úì <strong>Sandboxes provide safe environments</strong> for running dangerous malware</li>
          <li>‚úì <strong>Automated analysis</strong> saves time and provides consistent results</li>
          <li>‚úì <strong>Multiple data sources</strong> (files, registry, network, memory) paint complete picture</li>
          <li>‚úì <strong>IOCs extracted</strong> from sandboxes can protect entire organizations</li>
          <li>‚úì <strong>Evasion techniques</strong> require analysts to think creatively</li>
        </ul>
      </div>

      <div className="bg-green-900 bg-opacity-20 rounded-lg p-6 border border-green-500 border-opacity-30">
        <h4 className="text-green-400 font-bold text-xl mb-3">üöÄ Practice Resources</h4>
        <p className="text-green-300 mb-3">
          Want to try real sandbox analysis? Check out these free platforms:
        </p>
        <ul className="text-green-300 space-y-1 text-sm">
          <li>‚Ä¢ <strong>Any.run:</strong> Free tier for interactive analysis</li>
          <li>‚Ä¢ <strong>Hybrid Analysis:</strong> Community submissions</li>
          <li>‚Ä¢ <strong>VirusTotal:</strong> Upload samples for multi-engine scanning</li>
          <li>‚Ä¢ <strong>Cuckoo Sandbox:</strong> Set up your own local instance</li>
          <li>‚Ä¢ <strong>Malware Bazaar:</strong> Download samples for practice</li>
        </ul>
      </div>
    </div>
  );
};

export default SandboxSection;
